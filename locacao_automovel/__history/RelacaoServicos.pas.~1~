unit RelacaoServicos;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Menus, Vcl.Grids, Vcl.DBGrids, db,
  SedDBGrid, Vcl.StdCtrls, Vcl.ExtCtrls;

type
  TRelacaoServicosForm = class(TForm)
    Panel1: TPanel;
    BtOk: TButton;
    BtNovo: TButton;
    BtCancelar: TButton;
    DBGrid4: TSedDBGrid;
    BtImprimir: TButton;
    PopupMenu2: TPopupMenu;
    Excluir1: TMenuItem;
    btLocacaoVeic: TButton;
    procedure BtNovoClick(Sender: TObject);
    procedure Excluir1Click(Sender: TObject);
    procedure BtImprimirClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure DBGrid4DblClick(Sender: TObject);
    procedure DBGrid4DrawColumnCell(Sender: TObject; const Rect: TRect;
      DataCol: Integer; Column: TColumn; State: TGridDrawState);
    procedure btLocacaoVeicClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  RelacaoServicosForm: TRelacaoServicosForm;

implementation

{$R *.dfm}

uses Base, Principal, ImprimirContrato, unRecursos, CadServCliente,
  GeraBoletoVeic;

procedure TRelacaoServicosForm.BtImprimirClick(Sender: TObject);
begin
if not BancodeDados.Cont_Serv_Clien.IsEmpty then
    if not Assigned(ImprimirContratoForm) then
      ImprimirContratoForm := tImprimirContratoForm.Create(Application);
    try
      ImprimirContratoForm.EditCodigo.Value   :=BancodeDados.Cont_Serv_ClienCLI_ID.Value;
      ImprimirContratoForm.LbNome.Caption     :=BancodeDados.ClientesNOME.Value;
      ImprimirContratoForm.ShowModal;
    finally
      ImprimirContratoForm.Release;
      ImprimirContratoForm := nil;
    end;
end;

procedure TRelacaoServicosForm.BtNovoClick(Sender: TObject);
begin
  try

    if not assigned(CadServClienteForm) then
      CadServClienteForm := TCadServClienteForm.create(Application);
    try
      BancodeDados.Cont_Serv_Clien.Append;
      CadServClienteForm.ShowModal;
    finally
      CadServClienteForm.Release;
      CadServClienteForm := nil;

    end;
  except
    On E: Exception do
      TraduzErro(E.Message);
  end;

end;

procedure TRelacaoServicosForm.btLocacaoVeicClick(Sender: TObject);
begin
  try
    HabilitarBotoes(Self, False);
    if not assigned(GeraBoletoVeicForm) then
      GeraBoletoVeicForm := tGeraBoletoVeicForm.create(application);
    GeraBoletoVeicForm.showmodal;
  finally
    GeraBoletoVeicForm.Release;
    GeraBoletoVeicForm := nil;
    HabilitarBotoes(Self, true);
  end;
end;

procedure TRelacaoServicosForm.DBGrid4DblClick(Sender: TObject);
begin
   if not Assigned(CadServClienteForm) then CadServClienteForm := tCadServClienteForm.create(Application);
    try

      CadServClienteForm.showmodal;
    finally
      CadServClienteForm.Release;
      CadServClienteForm := nil;
    end;

end;

procedure TRelacaoServicosForm.DBGrid4DrawColumnCell(Sender: TObject;
  const Rect: TRect; DataCol: Integer; Column: TColumn; State: TGridDrawState);
begin

  if BancodeDados.Cont_Serv_ClienVEICULO_ID.Value>0 then
  begin
      if (BancodeDados.Cont_Serv_ClienSIT.Value=0) // 0 - Locado
      then
      begin
        DBGrid4.Canvas.Font.Color := clBlue;
        DBGrid4.Canvas.Font.Style := [fsBold];
      end else
      if (BancodeDados.Cont_Serv_ClienSIT.Value = 1) then  //1 - Cancelado
      begin
        DBGrid4.Canvas.Font.Color := $009F9F9F;
      end else
      if (BancodeDados.Cont_Serv_ClienSIT.Value = 2) then  //2 - Devolvido
      begin
        DBGrid4.Canvas.Font.Color := clNavy;
      end;

      DBGrid4.DefaultDrawDataCell(Rect, DBGrid4.Columns[DataCol].Field, State);
  end;


end;

procedure TRelacaoServicosForm.Excluir1Click(Sender: TObject);
begin
  if Mensagem('Tem certeza que deseja excluir?', mtConfirmation, [mbyes, mbNo], mryes, 0) = idYes then
  begin
    if not BancodeDados.FDConnection1.InTransaction then
      BancodeDados.FDConnection1.StartTransaction;
    BancodeDados.Cont_Serv_Clien.Delete;
    BancodeDados.FDConnection1.CommitRetaining;
  end;

end;

procedure TRelacaoServicosForm.FormShow(Sender: TObject);
begin

    DBGrid4.SetFocus;
    BancodeDados.Cont_Serv_Clien.Close;
    BancodeDados.Cont_Serv_Clien.SQL.Text := 'select * from cont_serv_clien where cli_id = ' + IntToStr(BancodeDados.ClientesCLI_ID.Value) +
      ' order by sit, DT_CAD desc';
    BancodeDados.Cont_Serv_Clien.Open;

end;



end.
